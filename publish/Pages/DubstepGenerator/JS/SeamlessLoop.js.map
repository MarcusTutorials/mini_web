{"version":3,"sources":["SeamlessLoop.js"],"names":["SeamlessLoop","this","is","ff","Boolean","window","mozInnerScreenX","test","navigator","userAgent","toLowerCase","ie","document","all","opera","chrome","safari","getComputedStyle","globalStorage","console","debug","_total","_load","cb_loaded","cb_loaded_flag","timeout","playDelay","stopDelay","next","audios","Array","actual","dropOld","old","_volume","t","_eventCanplaythrough","audBool","loaded","_eventPlaying","audMute","setTimeout","pause","currentTime","e","message","paused","_eventEnded","aud","volume","doLoop","key","antikey","_length","play","isLoaded","prototype","start","id","vol","_1","_2","stop","clearTimeout","callback","update","sync","addUri","uri","length","_1_isLoaded","_2_isLoaded","Audio","addEventListener","load"],"mappings":"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","file":"SeamlessLoop.js","sourcesContent":["/**\n * SeamlessLoop.js 2.0 - Reproduces seamless loops on HTML5/Javascript\n * https://github.com/Hivenfour/SeamlessLoop\n * \n * Copyright (c) 2012 Main Software,\n * Written by Dar√≠o Tejedor Rico. Contact mail: hivenfour@gmail.com\n * The source code is freely distributable under the terms of LGPL license.\n * License details at http://www.gnu.org/licenses/lgpl-3.0.txt\n * \n * USAGE:\n * - Create the Seamlessloop object\n * \t\tvar loop = new SeamlessLoop();\n * \n * - Add as many sounds as you will use, providing duration in miliseconds\n * (sounds must be pre-loaded if you want to update the loop without gaps)\n * \t\tloop.addUri(uri, length, \"sound1\");\n * \t\tloop.addUri(uri, length, \"sound2\");\n * ...\n * \n * - Establish your callback function that will be called when all sounds are pre-loaded\n * \t\tloop.callback(soundsLoaded);\n * \n * - Start reproducing the seamless loop:\n * \t\tfunction soundsLoaded() {\n * \t\t\tvar n = 1;\n * \t\t\tloop.start(\"sound\" + n);\n * \t\t};\n * \n * - Update the looping sound, you can do this\n * synchronously (waiting the loop to finish)\n * or asynchronously (change sound immediately):\n * \t\tn++;\n * \t\tloop.update(\"sound\" + n, false);\n * \n * - Modify the seamless loop volume:\n * \t\tloop.volume(0.5);\n * \t\tloop.volume(loop.volume() + 0.1);\n * \n * - Stop the seamless loop:\n * \t\tloop.stop();\n */\n\nfunction SeamlessLoop() {\n\tthis.is = {\n\t\t\t  ff: Boolean(!(window.mozInnerScreenX == null) && /firefox/.test( navigator.userAgent.toLowerCase() )),\n\t\t\t  ie: Boolean(document.all && !window.opera),\n\t\t\t  opera: Boolean(window.opera),\n\t\t\t  chrome: Boolean(window.chrome),\n\t\t\t  safari: Boolean(!window.chrome && /safari/.test( navigator.userAgent.toLowerCase() ) && window.getComputedStyle && !window.globalStorage && !window.opera)\n\t\t\t};\n\tconsole.debug(\"ff: \" + this.is.ff);\n\tconsole.debug(\"ie: \" + this.is.ie);\n\tconsole.debug(\"opera: \" + this.is.opera);\n\tconsole.debug(\"chrome: \" + this.is.chrome);\n\tconsole.debug(\"safari: \" + this.is.safari);\n\tthis._total = 0;\n\tthis._load = 0;\n\tthis.cb_loaded;\n\tthis.cb_loaded_flag = new Boolean();\n\tthis.timeout;\n\tthis.playDelay = -30;\n\tthis.stopDelay = 30;\n\tif(this.is.chrome) this.playDelay = -25;\n\tif(this.is.chrome) this.stopDelay = 25;\n\tif(this.is.ff) this.playDelay = -25;\n\tif(this.is.ff) this.stopDelay = 85;\n\tif(this.is.opera) this.playDelay = 5;\n\tif(this.is.opera) this.stopDelay = 0;\n\tconsole.debug(this.playDelay + \", \" + this.stopDelay);\n\tthis.next = 1;\n\tthis.audios = new Array();\n\tthis.actual = new Array();\n\tthis.dropOld = new Boolean();\n\tthis.old;\n\tthis._volume = 1;\n\t\n\tvar t = this;\n\tthis._eventCanplaythrough = function(audBool) {\n\t\tif(audBool == false) {\n\t\t\taudBool = true;\n\t\t\tt._load++;\n\t\t\tif(t._load == t._total) {\n\t\t\t\tt.loaded = true;\n\t\t\t\tif(t.cb_loaded_flag == true) {\n\t\t\t\t\tt.cb_loaded();\n\t\t\t\t\tt.cb_loaded_flag = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t\n\tthis._eventPlaying = function(audMute) {\n\t\tsetTimeout(function() {\n\t\t\taudMute.pause();\n\t\t\ttry {\n\t\t\t\taudMute.currentTime = 0;\n\t\t\t} catch (e){console.debug(e.message);};\n\t\t}, t.stopDelay);\n\t\t\n\t\tif(t.dropOld == true) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tif(t.old.paused == false) {\n\t\t\t\t\tt.old.pause();\n\t\t\t\t\ttry {\n\t\t\t\t\t\tt.old.currentTime = 0;\n\t\t\t\t\t} catch (e){console.debug(e.message);};\n\t\t\t\t}\n\t\t\t}, t.stopDelay);\n\t\t\tt.dropOld = false;\n\t\t}\n\t};\n\n\tthis._eventEnded = function(aud) {\n\t\taud.volume = this._volume;\n\t};\n\n\tthis.doLoop = function() {\n\t\tvar key = (this.next == 1 ? \"_1\" : \"_2\");\n\t\tvar antikey = (this.next == 1 ? \"_2\" : \"_1\");\n\t\t\n\t\tvar t = this;\n\t\tthis.timeout = setTimeout(function() {t.doLoop();}, this.actual._length + this.playDelay);\n\t\t\n\t\tif(this.is.opera) this.actual[antikey].pause();\n\t\t\n\t\tthis.actual[key].play();\n\t\tthis.next *= -1;\n\t};\n\t\n\tthis.isLoaded = function() {\n\t\treturn Boolean(this._load == this._total);\n\t};\n}\n\nSeamlessLoop.prototype.start = function(id) {\n\tif(id != \"\") {\n\t\tthis.actual = this.audios[id];\n\t}\n\tthis.doLoop();\n};\n\nSeamlessLoop.prototype.volume = function(vol) {\n\tif(typeof vol != \"undefined\") {\n\t\tthis.actual._1.volume = vol;\n        \tthis.actual._2.volume = vol;\n\t\tthis._volume = vol;\n\t}\n\t\n\treturn vol;\n};\n\nSeamlessLoop.prototype.stop = function() {\n\tclearTimeout(this.timeout);\n\tthis.actual._1.currentTime = 0;\n\tthis.actual._1.pause();\n\tthis.actual._2.currentTime = 0;\n\tthis.actual._2.pause();\n};\n\nSeamlessLoop.prototype.callback = function(cb_loaded) {\n\tthis.cb_loaded = cb_loaded;\n\tif(this.isLoaded() == true) cb_loaded();\n\telse this.cb_loaded_flag = true;\n};\n\nSeamlessLoop.prototype.update = function(id, sync) {\n\t//var key = (this.next == 1 ? \"_1\" : \"_2\");\n\tvar antikey = (this.next == 1 ? \"_2\" : \"_1\");\n\n\tthis.old = this.actual[antikey];\n\tthis.actual = this.audios[id];\n\tif(sync == false) {\n\t\tif(this.old.paused == false) {\n\t\t\tthis.dropOld = true;\n\t\t\tif(this.is.opera) this.old.pause();\n\t\t}\n\t\tclearTimeout(this.timeout);\n\t\tthis.doLoop();\n\t}\n};\n\nSeamlessLoop.prototype.addUri = function(uri, length, id) {\n\tthis.audios[id] = new Array();\n\tthis.audios[id]._length = length;\n\tvar t = this;\n\tthis.audios[id]._1_isLoaded = new Boolean();\n\tthis.audios[id]._2_isLoaded = new Boolean();\n\tthis.audios[id]._1 = new Audio(uri);\n\tthis.audios[id]._2 = new Audio(uri);\n\tthis._total++;\n\tthis.audios[id]._1.addEventListener(\"canplaythrough\", function() {t._eventCanplaythrough(t.audios[id]._1_isLoaded);});\n\tthis.audios[id]._2.addEventListener(\"canplaythrough\", function() {t._eventCanplaythrough(t.audios[id]._2_isLoaded);});\n\tthis.audios[id]._1.addEventListener(\"playing\", function() {t._eventPlaying(t.audios[id]._2);});\n\tthis.audios[id]._2.addEventListener(\"playing\", function() {t._eventPlaying(t.audios[id]._1);});\n\tthis.audios[id]._1.addEventListener(\"ended\", function() {t._eventEnded(t.audios[id]._1);});\n\tthis.audios[id]._2.addEventListener(\"ended\", function() {t._eventEnded(t.audios[id]._2);});\n\tthis.audios[id]._1.load();\n\tthis.audios[id]._2.load();\n\tthis.audios[id]._1.volume = this._volume;\n\tthis.audios[id]._2.volume = this._volume;\n};\n"]}